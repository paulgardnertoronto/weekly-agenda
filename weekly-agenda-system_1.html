<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Agenda & Task Manager</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f7f6f3;
            color: #37352f;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .date-display {
            color: #787774;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .tab:hover {
            background: #f1f0ef;
        }

        .tab.active {
            background: #e8e7e5;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 600;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #2383e2;
            color: white;
        }

        .btn-primary:hover {
            background: #1a6ec7;
        }

        .btn-secondary {
            background: #e8e7e5;
            color: #37352f;
        }

        .btn-secondary:hover {
            background: #d3d2ce;
        }

        .btn-delete {
            background: #eb5757;
            color: white;
            padding: 4px 12px;
            font-size: 12px;
        }

        .btn-delete:hover {
            background: #d43f3f;
        }

        /* Weekly Calendar Grid */
        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .day-card {
            background: #fafafa;
            border: 1px solid #e8e7e5;
            border-radius: 6px;
            padding: 15px;
            min-height: 250px;
        }

        .day-header {
            font-weight: 600;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8e7e5;
        }

        .day-date {
            font-size: 0.85em;
            color: #787774;
        }

        .day-items {
            margin-top: 10px;
        }

        .day-item {
            background: white;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 8px;
            font-size: 0.9em;
            border-left: 3px solid #2383e2;
        }

        .day-item.meeting {
            border-left-color: #9b59b6;
        }

        .day-item.task {
            border-left-color: #2ecc71;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 12px;
            font-weight: 600;
            border-bottom: 2px solid #e8e7e5;
            font-size: 0.9em;
            color: #787774;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #f1f0ef;
        }

        tr:hover {
            background: #fafafa;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.9em;
        }

        input[type="text"],
        input[type="date"],
        input[type="time"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e8e7e5;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        select {
            cursor: pointer;
        }

        /* Status Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .badge-todo {
            background: #e8e7e5;
            color: #37352f;
        }

        .badge-in-progress {
            background: #d3e5ff;
            color: #0b5394;
        }

        .badge-done {
            background: #d4edda;
            color: #155724;
        }

        .badge-high {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-medium {
            background: #fff3cd;
            color: #856404;
        }

        .badge-low {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #787774;
        }

        .close-btn:hover {
            color: #37352f;
        }

        /* Notes Section */
        .note-card {
            background: #fffbea;
            border: 1px solid #f5e5a8;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .note-date {
            font-size: 0.85em;
            color: #787774;
        }

        .note-content {
            white-space: pre-wrap;
        }

        /* Filter Bar */
        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-bar select {
            width: auto;
            min-width: 150px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .week-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .week-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .week-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Daily View Styles */
        .daily-item-card {
            background: white;
            border: 1px solid #e8e7e5;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #2383e2;
            transition: all 0.2s;
        }

        .daily-item-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .daily-item-card.meeting {
            border-left-color: #9b59b6;
        }

        .daily-item-card.task {
            border-left-color: #2ecc71;
        }

        .daily-item-card.task.high {
            border-left-color: #e74c3c;
        }

        .daily-item-card.task.done {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .daily-item-title {
            font-weight: 600;
            font-size: 1.05em;
            margin-bottom: 8px;
        }

        .daily-item-meta {
            font-size: 0.85em;
            color: #787774;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .daily-summary-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e8e7e5;
        }

        .daily-summary-stat:last-child {
            border-bottom: none;
        }

        .daily-summary-label {
            color: #787774;
        }

        .daily-summary-value {
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #787774;
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìÖ Weekly Agenda & Task Manager</h1>
            <div class="date-display" id="currentDate"></div>
            <div style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="handleAuthClick()" id="authorize_button" style="display: none;">
                    üîë Connect Google Calendar
                </button>
                <button class="btn btn-primary" onclick="syncGoogleCalendar()" id="sync_button" style="display: none;">
                    üîÑ Sync with Google Calendar
                </button>
                <button class="btn btn-secondary" onclick="handleSignoutClick()" id="signout_button" style="display: none;">
                    üö™ Disconnect
                </button>
                <span id="sync_status" style="margin-left: 10px; color: #787774; font-size: 0.9em;"></span>
            </div>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('daily')">Daily View</button>
            <button class="tab" onclick="switchTab('weekly')">Weekly View</button>
            <button class="tab" onclick="switchTab('meetings')">Meetings Database</button>
            <button class="tab" onclick="switchTab('tasks')">Tasks</button>
            <button class="tab" onclick="switchTab('notes')">Notes</button>
        </div>

        <!-- Daily View Tab -->
        <div id="daily" class="tab-content active">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title" id="dailyViewTitle">Today's Agenda</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="previousDay()">‚Üê Previous</button>
                        <button class="btn btn-secondary" onclick="nextDay()">Next ‚Üí</button>
                        <button class="btn btn-primary" onclick="goToTodayDaily()">Today</button>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: #f7f6f3; padding: 20px; border-radius: 8px;">
                        <h3 style="margin-bottom: 15px; font-size: 1.2em;">üìä Daily Summary</h3>
                        <div id="dailySummary"></div>
                    </div>
                    <div style="background: #f7f6f3; padding: 20px; border-radius: 8px;">
                        <h3 style="margin-bottom: 15px; font-size: 1.2em;">‚è∞ Quick Add</h3>
                        <button class="btn btn-primary" onclick="openMeetingModal()" style="margin-right: 10px; margin-bottom: 10px;">+ Meeting</button>
                        <button class="btn btn-primary" onclick="openTaskModal()" style="margin-bottom: 10px;">+ Task</button>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Meetings Column -->
                    <div>
                        <h3 style="margin-bottom: 15px; font-size: 1.2em; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ü§ù</span> Meetings
                        </h3>
                        <div id="dailyMeetings"></div>
                    </div>

                    <!-- Tasks Column -->
                    <div>
                        <h3 style="margin-bottom: 15px; font-size: 1.2em; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">‚úì</span> Tasks
                        </h3>
                        <div id="dailyTasks"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weekly View Tab -->
        <div id="weekly" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">This Week</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="previousWeek()">‚Üê Previous</button>
                        <button class="btn btn-secondary" onclick="nextWeek()">Next ‚Üí</button>
                        <button class="btn btn-primary" onclick="goToToday()">Today</button>
                    </div>
                </div>
                <div class="week-grid" id="weekGrid"></div>
            </div>
        </div>

        <!-- Meetings Tab -->
        <div id="meetings" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Meetings Database</h2>
                    <button class="btn btn-primary" onclick="openMeetingModal()">+ New Meeting</button>
                </div>
                
                <div class="filter-bar">
                    <select id="meetingTypeFilter" onchange="filterMeetings()">
                        <option value="">All Types</option>
                        <option value="1-on-1">1-on-1</option>
                        <option value="Team">Team Meeting</option>
                        <option value="Client">Client Call</option>
                        <option value="Planning">Planning</option>
                        <option value="Other">Other</option>
                    </select>
                    <select id="meetingStatusFilter" onchange="filterMeetings()">
                        <option value="">All Status</option>
                        <option value="Scheduled">Scheduled</option>
                        <option value="Completed">Completed</option>
                        <option value="Cancelled">Cancelled</option>
                    </select>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Attendees</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="meetingsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tasks Tab -->
        <div id="tasks" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Tasks</h2>
                    <button class="btn btn-primary" onclick="openTaskModal()">+ New Task</button>
                </div>

                <div class="filter-bar">
                    <select id="taskStatusFilter" onchange="filterTasks()">
                        <option value="">All Status</option>
                        <option value="To Do">To Do</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Done">Done</option>
                    </select>
                    <select id="taskPriorityFilter" onchange="filterTasks()">
                        <option value="">All Priorities</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Task</th>
                                <th>Priority</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Category</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tasksTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Notes Tab -->
        <div id="notes" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Notes</h2>
                    <button class="btn btn-primary" onclick="openNoteModal()">+ New Note</button>
                </div>
                <div id="notesContainer"></div>
            </div>
        </div>

        <!-- Meeting Modal -->
        <div id="meetingModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Add Meeting</h3>
                    <button class="close-btn" onclick="closeMeetingModal()">&times;</button>
                </div>
                <form id="meetingForm" onsubmit="saveMeeting(event)">
                    <div class="form-group">
                        <label>Meeting Title *</label>
                        <input type="text" id="meetingTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select id="meetingType">
                            <option value="1-on-1">1-on-1</option>
                            <option value="Team">Team Meeting</option>
                            <option value="Client">Client Call</option>
                            <option value="Planning">Planning</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" id="meetingDate" required>
                    </div>
                    <div class="form-group">
                        <label>Time *</label>
                        <input type="time" id="meetingTime" required>
                    </div>
                    <div class="form-group">
                        <label>Attendees</label>
                        <input type="text" id="meetingAttendees" placeholder="Comma-separated names">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="meetingStatus">
                            <option value="Scheduled">Scheduled</option>
                            <option value="Completed">Completed</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="meetingNotes" placeholder="Meeting agenda, notes, or outcomes..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Meeting</button>
                </form>
            </div>
        </div>

        <!-- Task Modal -->
        <div id="taskModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Add Task</h3>
                    <button class="close-btn" onclick="closeTaskModal()">&times;</button>
                </div>
                <form id="taskForm" onsubmit="saveTask(event)">
                    <div class="form-group">
                        <label>Task Name *</label>
                        <input type="text" id="taskName" required>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="taskPriority">
                            <option value="Low">Low</option>
                            <option value="Medium">Medium</option>
                            <option value="High">High</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" id="taskDueDate">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="taskStatus">
                            <option value="To Do">To Do</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Done">Done</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" id="taskCategory" placeholder="e.g., Work, Personal, Project">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="taskDescription" placeholder="Task details..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Task</button>
                </form>
            </div>
        </div>

        <!-- Note Modal -->
        <div id="noteModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Add Note</h3>
                    <button class="close-btn" onclick="closeNoteModal()">&times;</button>
                </div>
                <form id="noteForm" onsubmit="saveNote(event)">
                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" id="noteTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Content *</label>
                        <textarea id="noteContent" required placeholder="Write your note here..." style="min-height: 200px;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Note</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // GOOGLE CALENDAR API CONFIGURATION
        // ============================================
        // IMPORTANT: Replace these with your own credentials
        // Follow the setup guide to get your API key and Client ID
        
        const GOOGLE_API_KEY = 'AIzaSyCpENPc1VFNLpxjky9MUut3DliqsOHC29I';
        const GOOGLE_CLIENT_ID = '378609359019-od4ibvjfhhs93fn46tdn5dnp0k25ke9j.apps.googleusercontent.com';
        
        // DO NOT CHANGE THESE
        const GOOGLE_DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
        const GOOGLE_SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;

        // Initialize Google API
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            try {
                await gapi.client.init({
                    apiKey: GOOGLE_API_KEY,
                    discoveryDocs: GOOGLE_DISCOVERY_DOCS,
                });
                gapiInited = true;
                maybeEnableButtons();
            } catch (error) {
                console.error('Error initializing GAPI client:', error);
                updateSyncStatus('Error initializing Google API. Check your API key.', true);
            }
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: GOOGLE_CLIENT_ID,
                scope: GOOGLE_SCOPES,
                callback: '', // defined later
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                // Check if credentials are configured
                if (GOOGLE_API_KEY === 'YOUR_API_KEY_HERE' || GOOGLE_CLIENT_ID === 'YOUR_CLIENT_ID_HERE.apps.googleusercontent.com') {
                    updateSyncStatus('‚ö†Ô∏è Google Calendar not configured. See setup guide.', true);
                    return;
                }
                
                document.getElementById('authorize_button').style.display = 'inline-block';
                updateSyncStatus('Ready to connect to Google Calendar');
            }
        }

        function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    console.error('Auth error:', resp);
                    updateSyncStatus('Authentication failed. Please try again.', true);
                    return;
                }
                
                document.getElementById('authorize_button').style.display = 'none';
                document.getElementById('sync_button').style.display = 'inline-block';
                document.getElementById('signout_button').style.display = 'inline-block';
                updateSyncStatus('‚úÖ Connected to Google Calendar');
                
                // Auto-sync on first connect
                await syncGoogleCalendar();
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }

        function handleSignoutClick() {
            const token = gapi.client.getToken();
            if (token !== null) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
                document.getElementById('authorize_button').style.display = 'inline-block';
                document.getElementById('sync_button').style.display = 'none';
                document.getElementById('signout_button').style.display = 'none';
                updateSyncStatus('Disconnected from Google Calendar');
            }
        }

        async function syncGoogleCalendar() {
            if (gapi.client.getToken() === null) {
                updateSyncStatus('Please connect to Google Calendar first', true);
                return;
            }

            updateSyncStatus('üîÑ Syncing...');

            try {
                // Get events for the next 30 days
                const now = new Date();
                const futureDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
                
                const response = await gapi.client.calendar.events.list({
                    'calendarId': 'primary',
                    'timeMin': now.toISOString(),
                    'timeMax': futureDate.toISOString(),
                    'showDeleted': false,
                    'singleEvents': true,
                    'maxResults': 100,
                    'orderBy': 'startTime'
                });

                const events = response.result.items;
                
                if (!events || events.length === 0) {
                    updateSyncStatus('No upcoming events found in Google Calendar');
                    return;
                }

                let importedCount = 0;
                let skippedCount = 0;

                events.forEach(event => {
                    // Skip events without start time
                    if (!event.start.dateTime && !event.start.date) {
                        return;
                    }

                    const startDateTime = new Date(event.start.dateTime || event.start.date);
                    const date = startDateTime.toISOString().split('T')[0];
                    const time = event.start.dateTime ? 
                        startDateTime.toTimeString().slice(0, 5) : 
                        '00:00';

                    // Check if event already exists (by Google event ID)
                    const exists = meetings.some(m => m.googleEventId === event.id);
                    
                    if (!exists) {
                        const meeting = {
                            id: Date.now() + Math.random(),
                            title: event.summary || 'Untitled Event',
                            type: determineEventType(event),
                            date: date,
                            time: time,
                            attendees: event.attendees ? 
                                event.attendees.map(a => a.displayName || a.email).join(', ') : 
                                '',
                            status: 'Scheduled',
                            notes: event.description || '',
                            googleEventId: event.id,
                            googleCalendarSync: true
                        };
                        
                        meetings.push(meeting);
                        importedCount++;
                    } else {
                        skippedCount++;
                    }
                });

                localStorage.setItem('meetings', JSON.stringify(meetings));
                renderMeetingsTable();
                renderWeeklyView();
                renderDailyView();
                
                updateSyncStatus(`‚úÖ Synced ${importedCount} new events (${skippedCount} already existed)`);
                
            } catch (error) {
                console.error('Sync error:', error);
                updateSyncStatus('‚ùå Sync failed. Check console for details.', true);
            }
        }

        function determineEventType(event) {
            const title = (event.summary || '').toLowerCase();
            const description = (event.description || '').toLowerCase();
            const attendeeCount = event.attendees ? event.attendees.length : 0;

            if (attendeeCount === 1 || title.includes('1:1') || title.includes('one-on-one') || title.includes('1 on 1')) {
                return '1-on-1';
            } else if (title.includes('team') || description.includes('team')) {
                return 'Team';
            } else if (title.includes('client') || description.includes('client')) {
                return 'Client';
            } else if (title.includes('planning') || title.includes('plan') || description.includes('planning')) {
                return 'Planning';
            }
            
            return 'Other';
        }

        function updateSyncStatus(message, isError = false) {
            const statusElement = document.getElementById('sync_status');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.style.color = isError ? '#eb5757' : '#787774';
            }
        }

        // Load APIs on page load
        window.addEventListener('load', () => {
            if (typeof gapi !== 'undefined') {
                gapiLoaded();
            }
            if (typeof google !== 'undefined') {
                gisLoaded();
            }
        });

        // ============================================
        // END GOOGLE CALENDAR API CONFIGURATION
        // ============================================

        // Data Storage
        let meetings = JSON.parse(localStorage.getItem('meetings')) || [];
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let currentWeekStart = new Date();
        let currentDailyDate = new Date();

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            setCurrentWeekStart();
            renderDailyView();
            renderWeeklyView();
            renderMeetingsTable();
            renderTasksTable();
            renderNotes();
            setTodayAsDefault();
        });

        function setTodayAsDefault() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('meetingDate').value = today;
            document.getElementById('taskDueDate').value = today;
        }

        function updateCurrentDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', options);
        }

        function setCurrentWeekStart() {
            const today = new Date();
            const day = today.getDay();
            const diff = today.getDate() - day; // Start on Sunday
            currentWeekStart = new Date(today.setDate(diff));
            currentWeekStart.setHours(0, 0, 0, 0);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Daily View Functions
        function renderDailyView() {
            const dateStr = currentDailyDate.toISOString().split('T')[0];
            const isToday = currentDailyDate.toDateString() === new Date().toDateString();
            
            // Update title
            const titleElement = document.getElementById('dailyViewTitle');
            if (isToday) {
                titleElement.textContent = "Today's Agenda";
            } else {
                titleElement.textContent = currentDailyDate.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    month: 'long', 
                    day: 'numeric',
                    year: 'numeric'
                });
            }
            
            // Get meetings and tasks for this day
            const dayMeetings = meetings.filter(m => m.date === dateStr).sort((a, b) => a.time.localeCompare(b.time));
            const dayTasks = tasks.filter(t => t.dueDate === dateStr);
            
            // Render summary
            renderDailySummary(dayMeetings, dayTasks);
            
            // Render meetings
            renderDailyMeetings(dayMeetings);
            
            // Render tasks
            renderDailyTasks(dayTasks);
        }

        function renderDailySummary(dayMeetings, dayTasks) {
            const summaryContainer = document.getElementById('dailySummary');
            
            const completedTasks = dayTasks.filter(t => t.status === 'Done').length;
            const pendingTasks = dayTasks.filter(t => t.status !== 'Done').length;
            const upcomingMeetings = dayMeetings.filter(m => m.status === 'Scheduled').length;
            
            summaryContainer.innerHTML = `
                <div class="daily-summary-stat">
                    <span class="daily-summary-label">Total Meetings</span>
                    <span class="daily-summary-value">${dayMeetings.length}</span>
                </div>
                <div class="daily-summary-stat">
                    <span class="daily-summary-label">Upcoming Meetings</span>
                    <span class="daily-summary-value">${upcomingMeetings}</span>
                </div>
                <div class="daily-summary-stat">
                    <span class="daily-summary-label">Total Tasks</span>
                    <span class="daily-summary-value">${dayTasks.length}</span>
                </div>
                <div class="daily-summary-stat">
                    <span class="daily-summary-label">Completed Tasks</span>
                    <span class="daily-summary-value" style="color: #2ecc71;">${completedTasks}</span>
                </div>
                <div class="daily-summary-stat">
                    <span class="daily-summary-label">Pending Tasks</span>
                    <span class="daily-summary-value" style="color: #e74c3c;">${pendingTasks}</span>
                </div>
            `;
        }

        function renderDailyMeetings(dayMeetings) {
            const container = document.getElementById('dailyMeetings');
            
            if (dayMeetings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÖ</div>
                        <div>No meetings scheduled</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = dayMeetings.map(meeting => `
                <div class="daily-item-card meeting">
                    <div class="daily-item-title">${meeting.title}</div>
                    <div class="daily-item-meta">
                        <span>‚è∞ ${meeting.time}</span>
                        <span>üìã ${meeting.type}</span>
                        ${meeting.attendees ? `<span>üë• ${meeting.attendees}</span>` : ''}
                    </div>
                    ${meeting.notes ? `<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e8e7e5; font-size: 0.9em;">${meeting.notes}</div>` : ''}
                    <div style="margin-top: 10px;">
                        <span class="badge badge-${meeting.status.toLowerCase()}">${meeting.status}</span>
                    </div>
                </div>
            `).join('');
        }

        function renderDailyTasks(dayTasks) {
            const container = document.getElementById('dailyTasks');
            
            if (dayTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚úì</div>
                        <div>No tasks for this day</div>
                    </div>
                `;
                return;
            }
            
            // Sort: incomplete tasks first, then by priority
            const sortedTasks = dayTasks.sort((a, b) => {
                if (a.status === 'Done' && b.status !== 'Done') return 1;
                if (a.status !== 'Done' && b.status === 'Done') return -1;
                
                const priorityOrder = { 'High': 0, 'Medium': 1, 'Low': 2 };
                return priorityOrder[a.priority] - priorityOrder[b.priority];
            });
            
            container.innerHTML = sortedTasks.map(task => `
                <div class="daily-item-card task ${task.priority.toLowerCase()} ${task.status === 'Done' ? 'done' : ''}">
                    <div class="daily-item-title">${task.name}</div>
                    <div class="daily-item-meta">
                        <span class="badge badge-${task.priority.toLowerCase()}">${task.priority}</span>
                        <span class="badge badge-${task.status.toLowerCase().replace(' ', '-')}">${task.status}</span>
                        ${task.category ? `<span>üè∑Ô∏è ${task.category}</span>` : ''}
                    </div>
                    ${task.description ? `<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e8e7e5; font-size: 0.9em; color: #787774;">${task.description}</div>` : ''}
                </div>
            `).join('');
        }

        function previousDay() {
            currentDailyDate.setDate(currentDailyDate.getDate() - 1);
            renderDailyView();
        }

        function nextDay() {
            currentDailyDate.setDate(currentDailyDate.getDate() + 1);
            renderDailyView();
        }

        function goToTodayDaily() {
            currentDailyDate = new Date();
            renderDailyView();
        }

        // Weekly View Functions
        function renderWeeklyView() {
            const weekGrid = document.getElementById('weekGrid');
            weekGrid.innerHTML = '';
            
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(currentWeekStart);
                date.setDate(date.getDate() + i);
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                
                const isToday = date.toDateString() === new Date().toDateString();
                
                dayCard.innerHTML = `
                    <div class="day-header">
                        <div style="font-weight: ${isToday ? 'bold' : '600'}; color: ${isToday ? '#2383e2' : '#37352f'}">
                            ${days[i]}
                        </div>
                        <div class="day-date">${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                    </div>
                    <div class="day-items" id="day-${i}"></div>
                `;
                
                weekGrid.appendChild(dayCard);
                
                // Add meetings and tasks for this day
                renderDayItems(i, date);
            }
        }

        function renderDayItems(dayIndex, date) {
            const dayContainer = document.getElementById(`day-${dayIndex}`);
            const dateStr = date.toISOString().split('T')[0];
            
            // Add meetings
            const dayMeetings = meetings.filter(m => m.date === dateStr);
            dayMeetings.forEach(meeting => {
                const item = document.createElement('div');
                item.className = 'day-item meeting';
                item.innerHTML = `
                    <div style="font-weight: 500;">${meeting.time} - ${meeting.title}</div>
                    <div style="font-size: 0.85em; color: #787774; margin-top: 4px;">${meeting.type}</div>
                `;
                dayContainer.appendChild(item);
            });
            
            // Add tasks
            const dayTasks = tasks.filter(t => t.dueDate === dateStr && t.status !== 'Done');
            dayTasks.forEach(task => {
                const item = document.createElement('div');
                item.className = 'day-item task';
                item.innerHTML = `
                    <div style="font-weight: 500;">‚úì ${task.name}</div>
                    <div style="font-size: 0.85em; color: #787774; margin-top: 4px;">${task.priority} priority</div>
                `;
                dayContainer.appendChild(item);
            });
            
            if (dayMeetings.length === 0 && dayTasks.length === 0) {
                dayContainer.innerHTML = '<div style="color: #787774; font-size: 0.85em; padding: 10px 0;">No items scheduled</div>';
            }
        }

        function previousWeek() {
            currentWeekStart.setDate(currentWeekStart.getDate() - 7);
            renderWeeklyView();
        }

        function nextWeek() {
            currentWeekStart.setDate(currentWeekStart.getDate() + 7);
            renderWeeklyView();
        }

        function goToToday() {
            setCurrentWeekStart();
            renderWeeklyView();
        }

        // Meeting Functions
        function openMeetingModal() {
            document.getElementById('meetingModal').classList.add('active');
        }

        function closeMeetingModal() {
            document.getElementById('meetingModal').classList.remove('active');
            document.getElementById('meetingForm').reset();
            setTodayAsDefault();
        }

        function saveMeeting(event) {
            event.preventDefault();
            
            const meeting = {
                id: Date.now(),
                title: document.getElementById('meetingTitle').value,
                type: document.getElementById('meetingType').value,
                date: document.getElementById('meetingDate').value,
                time: document.getElementById('meetingTime').value,
                attendees: document.getElementById('meetingAttendees').value,
                status: document.getElementById('meetingStatus').value,
                notes: document.getElementById('meetingNotes').value
            };
            
            meetings.push(meeting);
            localStorage.setItem('meetings', JSON.stringify(meetings));
            
            renderMeetingsTable();
            renderWeeklyView();
            renderDailyView();
            closeMeetingModal();
        }

        function renderMeetingsTable() {
            const tbody = document.getElementById('meetingsTable');
            const typeFilter = document.getElementById('meetingTypeFilter')?.value || '';
            const statusFilter = document.getElementById('meetingStatusFilter')?.value || '';
            
            let filteredMeetings = meetings;
            
            if (typeFilter) {
                filteredMeetings = filteredMeetings.filter(m => m.type === typeFilter);
            }
            if (statusFilter) {
                filteredMeetings = filteredMeetings.filter(m => m.status === statusFilter);
            }
            
            filteredMeetings.sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time));
            
            tbody.innerHTML = filteredMeetings.map(meeting => `
                <tr>
                    <td>
                        <strong>${meeting.title}</strong>
                        ${meeting.googleCalendarSync ? '<span style="margin-left: 8px; font-size: 0.85em;">üìÖ</span>' : ''}
                    </td>
                    <td>${meeting.type}</td>
                    <td>${new Date(meeting.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</td>
                    <td>${meeting.time}</td>
                    <td>${meeting.attendees || '-'}</td>
                    <td><span class="badge badge-${meeting.status.toLowerCase().replace(' ', '-')}">${meeting.status}</span></td>
                    <td><button class="btn btn-delete" onclick="deleteMeeting(${meeting.id})">Delete</button></td>
                </tr>
            `).join('');
        }

        function filterMeetings() {
            renderMeetingsTable();
        }

        function deleteMeeting(id) {
            if (confirm('Are you sure you want to delete this meeting?')) {
                meetings = meetings.filter(m => m.id !== id);
                localStorage.setItem('meetings', JSON.stringify(meetings));
                renderMeetingsTable();
                renderWeeklyView();
                renderDailyView();
            }
        }

        // Task Functions
        function openTaskModal() {
            document.getElementById('taskModal').classList.add('active');
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.remove('active');
            document.getElementById('taskForm').reset();
            setTodayAsDefault();
        }

        function saveTask(event) {
            event.preventDefault();
            
            const task = {
                id: Date.now(),
                name: document.getElementById('taskName').value,
                priority: document.getElementById('taskPriority').value,
                dueDate: document.getElementById('taskDueDate').value,
                status: document.getElementById('taskStatus').value,
                category: document.getElementById('taskCategory').value,
                description: document.getElementById('taskDescription').value
            };
            
            tasks.push(task);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            renderTasksTable();
            renderWeeklyView();
            renderDailyView();
            closeTaskModal();
        }

        function renderTasksTable() {
            const tbody = document.getElementById('tasksTable');
            const statusFilter = document.getElementById('taskStatusFilter')?.value || '';
            const priorityFilter = document.getElementById('taskPriorityFilter')?.value || '';
            
            let filteredTasks = tasks;
            
            if (statusFilter) {
                filteredTasks = filteredTasks.filter(t => t.status === statusFilter);
            }
            if (priorityFilter) {
                filteredTasks = filteredTasks.filter(t => t.priority === priorityFilter);
            }
            
            filteredTasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
            
            tbody.innerHTML = filteredTasks.map(task => `
                <tr>
                    <td><strong>${task.name}</strong></td>
                    <td><span class="badge badge-${task.priority.toLowerCase()}">${task.priority}</span></td>
                    <td>${task.dueDate ? new Date(task.dueDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '-'}</td>
                    <td><span class="badge badge-${task.status.toLowerCase().replace(' ', '-')}">${task.status}</span></td>
                    <td>${task.category || '-'}</td>
                    <td><button class="btn btn-delete" onclick="deleteTask(${task.id})">Delete</button></td>
                </tr>
            `).join('');
        }

        function filterTasks() {
            renderTasksTable();
        }

        function deleteTask(id) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== id);
                localStorage.setItem('tasks', JSON.stringify(tasks));
                renderTasksTable();
                renderWeeklyView();
                renderDailyView();
            }
        }

        // Note Functions
        function openNoteModal() {
            document.getElementById('noteModal').classList.add('active');
        }

        function closeNoteModal() {
            document.getElementById('noteModal').classList.remove('active');
            document.getElementById('noteForm').reset();
        }

        function saveNote(event) {
            event.preventDefault();
            
            const note = {
                id: Date.now(),
                title: document.getElementById('noteTitle').value,
                content: document.getElementById('noteContent').value,
                date: new Date().toISOString()
            };
            
            notes.push(note);
            localStorage.setItem('notes', JSON.stringify(notes));
            
            renderNotes();
            closeNoteModal();
        }

        function renderNotes() {
            const container = document.getElementById('notesContainer');
            
            notes.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = notes.map(note => `
                <div class="note-card">
                    <div class="note-header">
                        <strong>${note.title}</strong>
                        <div>
                            <span class="note-date">${new Date(note.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</span>
                            <button class="btn btn-delete" onclick="deleteNote(${note.id})" style="margin-left: 10px;">Delete</button>
                        </div>
                    </div>
                    <div class="note-content">${note.content}</div>
                </div>
            `).join('');
            
            if (notes.length === 0) {
                container.innerHTML = '<p style="color: #787774;">No notes yet. Click "New Note" to get started!</p>';
            }
        }

        function deleteNote(id) {
            if (confirm('Are you sure you want to delete this note?')) {
                notes = notes.filter(n => n.id !== id);
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotes();
            }
        }
    </script>
</body>
</html>